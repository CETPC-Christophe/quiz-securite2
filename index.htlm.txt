<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Quiz sécurité - Évaluation</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h2 { color: #0066cc; text-align: center; }
#questionContainer { margin-top: 20px; }
.question { background:#f0f0f0; padding:15px; margin-bottom:10px; border-radius:8px; }
button { padding:10px 20px; margin-top:10px; background:#0066cc; color:#fff; border:none; border-radius:8px; cursor:pointer; }
button:hover { background:#005bb5; }
#results { margin-top:20px; text-align:center; font-weight:bold; }
</style>
</head>
<body>

<h2>Quiz d’évaluation sécurité</h2>
<label>Nom du candidat : <input type="text" id="nom" /></label>

<div id="questionContainer"></div>

<div style="text-align:center;">
  <button onclick="valider()">✅ Valider</button>
</div>

<div id="results"></div>

<script>
const webAppUrl = 'https://script.google.com/macros/s/AKfycbzTwpX885b_6iRfbbXnO4bAdRoRmAuUbMswHXvC7CwLEUIOYQNWkt1sm30Dwhbq7CrEUA';

const allQuestions = [
{text:"Le conducteur d'un engin de chantier est réglementé par le code du travail.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le conducteur d'un engin de chantier est réglementé par le code de la route.", answers:["Vrai","Faux"], correct:"Faux"},
{text:"Le matériel est réglementé par le code du travail.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le CACES engins de chantier est réglementé par la recommandation R482.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"La conduite sur route d'un engin n'est pas réglementée.", answers:["Vrai","Faux"], correct:"Faux"},
{text:"La formation du conducteur d'engins est obligatoire selon le code du travail.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Toute personne conduisant un engin doit être formée.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"L'autorisation de conduite doit être conservée sur soi.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le conducteur est responsable du chargement.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le conducteur doit respecter la zone de travail.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"L'inspecteur du travail peut imposer des vérifications.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le médecin du travail réalise les visites périodiques.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le représentant de la CARSAT peut analyser les risques.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le fabricant doit fournir un matériel conforme.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"L'OPPBTP conseille les entreprises.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le coordonnateur SPS est un acteur de l'encadrement chantier.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le conducteur doit conserver l'autorisation de conduite.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"La vitesse maximale d'un engin est limitée à 25 km/h.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"L'aptitude médicale doit être attestée par un médecin du travail.", answers:["Vrai","Faux"], correct:"Vrai"},
{text:"Le permis C est obligatoire pour conduire certains engins de chantier.", answers:["Vrai","Faux"], correct:"Faux"}
];

let questionsSelectionnees = [];
let score = 0;

function tirerQuestions(nb) {
  let questions = [...allQuestions];
  for (let i=questions.length-1; i>0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [questions[i], questions[j]] = [questions[j], questions[i]];
  }
  return questions.slice(0, nb);
}

function afficherQuestions() {
  questionsSelectionnees = tirerQuestions(20);
  const container = document.getElementById('questionContainer');
  container.innerHTML = '';
  questionsSelectionnees.forEach((q, i) => {
    let html = `<div class="question"><b>Q${i+1} :</b> ${q.q}<br/>`;
    q.answers.forEach(ans => {
      html += `<label><input type="radio" name="q${i}" value="${ans}"> ${ans}</label><br/>`;
    });
    html += `</div>`;
    container.innerHTML += html;
  });
}

function valider() {
  const nom = document.getElementById('nom').value.trim();
  if (!nom) { alert('Entrez votre nom'); return; }

  score = 0;
  questionsSelectionnees.forEach((q, i) => {
    const choix = document.querySelector(`input[name="q${i}"]:checked`);
    if (choix && choix.value===q.correct) score++;
  });
  document.getElementById('results').innerHTML = `Note : ${score} / 20`;

  // Préparer et envoyer
  const reponses = questionsSelectionnees.map((q,i) => {
    const choix = document.querySelector(`input[name="q${i}"]:checked`);
    return choix ? choix.value : '';
  });
  const dataEnvoyee = {
    nom: nom,
    date: new Date().toISOString(),
    score: score,
    reponses: reponses
  };
  fetch(webAppUrl, {
    method: 'POST',
    body: JSON.stringify(dataEnvoyee),
    headers: { 'Content-Type': 'application/json' }
  }).then(()=>{ alert('Résultat enregistré'); })
    .catch(()=>{ alert('Erreur lors de l\'envoi'); });
}

window.onload = () => { afficherQuestions(); };
</script>
</body>
</html>